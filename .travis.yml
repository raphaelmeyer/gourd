language: go

go:
  - 1.0
  - 1.1
  - 1.2

env:
  - CUCUMBER=true
  - CUCUMBER=false
  - COVERAGE=true
  - COVERAGE=false

matrix:
  exclude:
    - env: CUCUMBER=true
    - env: COVERAGE=true
    - go: 1.2
      env: CUCUMBER=false COVERAGE=false
  include:
    - go: 1.2
      env: CUCUMBER=true COVERAGE=true

before_install:
  - if [ "$CUCUMBER" == "true" ]; then ( gem install cucumber ); fi

install:
  - go get -v ./...
  - go get -v github.com/stretchr/testify
  - if [ "$COVERAGE" == "true" ]; then ( go get github.com/mattn/goveralls ); fi

script:
  - if [ "$CUCUMBER" == "true" ]; then ( go run features/steps.go & ); ( sleep 1 && cucumber ); fi
  - if [ "$COVERAGE" == "false" ]; then ( go test -v ./... ); fi
  - if [ "$COVERAGE" == "true" ]; then ( go test -v -covermode=count -coverprofile=gourd.cov ./... ); fi
  - if [ "$COVERAGE" == "true" ]; then ( goveralls -coverprofile=gourd.cov -service=travis-ci ); fi

notifications:
  email:
    on_success: change
    on_failure: always

